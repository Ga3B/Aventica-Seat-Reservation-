{% extends 'header.html' %}
{% load static %}
{% block title %}
  Placeholder Title
{% endblock %}
{% block content %}

<div class="title text-center mt-3">
    <h3>Выберите время</h3>
</div>

<div class="progress m-4">
    <div class="progress-bar" role="progressbar" style="width: 80%;" aria-valuenow="80" aria-valuemin="0"
        aria-valuemax="100">80%</div>
</div>

<!-- <div class="title text-center mt-3">
    <p class="">Выберите подходящее время, в которое хотите поработать</p>
</div> -->

<div class="card" style="margin-left:20%; margin-right:15%;">
    <div class="content">
        <div class="row">
            {% if room %}
            <div class="col-md-4">
                <div class="card m-3 shadow-sm">
                    <img src="{% static room.photo.url %}" class="img-fluid" alt="">
                    <div class="card-body">
                        <p class="card-text">{{ room.description }}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="btn-group">
                                {% for tag in room.tags.all %}
                                    <a type="button" class="btn btn-sm btn-outline-secondary m-1">{{ tag.name }}</a>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <p>
                <div class="container">
                    <h6>{{ room.name }}</h6>
                    <p> {{ room.location }} </p>
                    <a>
                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-flag-fill" fill="currentColor"
                            xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd"
                                d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.006.003-.023.009a12.435 12.435 0 0 1-.397.15c-.264.095-.631.223-1.047.35-.816.252-1.879.523-2.71.523-.847 0-1.548-.28-2.158-.525l-.028-.01C7.68 8.71 7.14 8.5 6.5 8.5c-.7 0-1.638.23-2.437.477A19.626 19.626 0 0 0 3 9.342V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a19.587 19.587 0 0 0 1.349-.476l.019-.007.004-.002h.001" />
                        </svg>
                    </a>

                    <form method="post">
                        <div class="form-group mt-5">
                            <input type="hidden" name="room_id" id="{{ room.id }}">
                            <label for="exampleFormControlTextarea1">Комментарий</label>
                            <textarea class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                            <label for="date">Выберите дату</label><input type="text" id="date">
                            <label for="time_start">Время начала</label><input type="datetime-local" id="time_start">
                            <label for="time_end">Время конца</label><input type="datetime-local" id="time_end">
                        </div>
                        <button id="book" type="submit" class="btn btn-primary"  data-toggle="modal" data-target="#exampleModal">Забронировать</button>
                        {% csrf_token %}
                    </form>
                </div>
                </p>
            </div>
            {% endif %}

<!--             {% if office %}
            <div class="col-md-4">
                <div class="card m-3 shadow-sm">
                    <img src="{% static room.photo.url %}" class="img-fluid" alt="">
                    <div class="card-body">
                        <p class="card-text">{{ office.description }}</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="btn-group">
                                {% for tag in workplace.tags.all %}
                                    <a type="button" class="btn btn-sm btn-outline-secondary m-1">{{ tag.name }}</a>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <p>
                <div class="container">
                    <h6>{{ office.name }}</h6>
                    <p> {{ office.location }} </p>
                    <a>
                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-flag-fill" fill="currentColor"
                            xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd"
                                d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.006.003-.023.009a12.435 12.435 0 0 1-.397.15c-.264.095-.631.223-1.047.35-.816.252-1.879.523-2.71.523-.847 0-1.548-.28-2.158-.525l-.028-.01C7.68 8.71 7.14 8.5 6.5 8.5c-.7 0-1.638.23-2.437.477A19.626 19.626 0 0 0 3 9.342V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a19.587 19.587 0 0 0 1.349-.476l.019-.007.004-.002h.001" />
                        </svg>
                        Мы не храним адреса, надо ли?
                    </a>
                    <div class="card mt-3">
                        <p>тут должен быть дропбокс со временем</p>
                    </div>

                    <form>
                        <div class="form-group mt-5">
                            <label for="exampleFormControlTextarea1">Комментарий</label>
                            <textarea class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                        </div>
                        <button type="button" class="btn btn-primary"  data-toggle="modal" data-target="#exampleModal">Дальше</button>
                        {% csrf_token %}
                    </form>
                </div>
                </p>
            </div>
            {% endif %}
 -->
        </div>
    </div>
</div>


<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Спасибо!</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Ваша заявка принята!
        </div>
        <div class="modal-footer">
          <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> -->
          <a type="button" href="{% url 'MainApp:my_booking' %}" class="btn btn-primary">В мои бронирования</a>
        </div>
      </div>
    </div>
  </div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
<script src="{% static 'js/jquery-ui.min.js' %}"></script>
<script src="{% static 'js/jquery-ui-timepicker-addon.js' %}"></script>

<script>
    // var start = $('#time_start');
    var default_settings = {
        timeFormat: 'HH:mm Z',
        timezoneList: [
            { value: 120, label: 'Калининград'}, 
            { value: 180, label: 'Москва' }, 
            { value: 240, label: 'Волгоград' }, 
            { value: 300, label: 'Екатеринбург' },
            { value: 360, label: 'Омск' }, 
            { value: 420, label: 'Красноярск' }, 
            { value: 480, label: 'Иркутск' }, 
            { value: 540, label: 'Якутск' },
            { value: 600, label: 'Владивосток' }, 
            { value: 660, label: 'Сахалин' }, 
            { value: 720, label: 'Камчатка' } 
        ],
        timezone: 180,
        stepMinute: 15,
        hourMin: 9,
        hourMax: 21,
    }
    start_settings = $.extend({}, default_settings);
    start_settings['onClose'] = function(dateText, inst) {
            // console.log(start.timepicker().val());
            $("#time_end").val(dateText);
        }

    $(function() {
        $("#date").datepicker({
            minDate: 0,
            maxDate: 14
        });
        $("#time_start").timepicker(start_settings);
        // $("#time_start").datepicker("show");
        $("#time_end").timepicker(default_settings);
        // $("#time_end").datepicker("show");
    });

    $("#book").on('click', function(e) {
        e.preventDefault();
        let token = $('[name=csrfmiddlewaretoken]').val();
        let date = $("#date").val();
        let start = $("#time_start").val();
        let finish = $("#time_end").val();
        let room_id = $("input[name=room_id]")[0].id;
        console.log(token, date, start, finish, room_id);
        $.ajax({
          headers: {'X-CSRFToken': token},
          type: 'POST',
          url: "{% url 'MainApp:book' %}",
          data: {"date": date, "start": start, "finish": finish, "room_id": room_id},
          success: function(response) {
            console.log(response);
            // $(".card-title").text(response['name']);
            // $("#chosen").text(response['name']);
            // $(".card-text").text(response['description']);
            // $('span.badge.badge-secondary').text(tags);
          },
          error: function(response) {
            alert("error")
          }
        });
    });
</script>

{% endblock %}